---
title: ä½¿ç”¨ Docker éƒ¨ç½² Mr.ğŸ†– AI æ•°æ®åº“
description: è¯¦ç»†æ­¥éª¤æ•™ä½ å¦‚ä½•åœ¨ Docker ä¸­éƒ¨ç½² Mr.ğŸ†– AI æœåŠ¡ç«¯æ•°æ®åº“ã€‚
tags:
  - Docker
  - Mr.ğŸ†– AI
  - æ•°æ®åº“éƒ¨ç½²
  - Postgres
---

# ä½¿ç”¨ Docker éƒ¨ç½²æœåŠ¡ç«¯æ•°æ®åº“ç‰ˆ

<div style={{display:"flex", gap: 4}}>
  [![][docker-release-shield]][docker-release-link]

[![][docker-size-shield]][docker-size-link]

[![][docker-pulls-shield]][docker-pulls-link]

</div>

<Callout type="info">
  æœ¬æ–‡å·²ç»å‡å®šä½ äº†è§£äº† Mr.ğŸ†– AI æœåŠ¡ç«¯æ•°æ®åº“ç‰ˆæœ¬ï¼ˆä¸‹ç®€ç§° DB
  ç‰ˆï¼‰çš„éƒ¨ç½²åŸºæœ¬åŸç†å’Œæµç¨‹ï¼Œå› æ­¤åªåŒ…å«æ ¸å¿ƒç¯å¢ƒå˜é‡é…ç½®çš„å†…å®¹ã€‚å¦‚æœä½ è¿˜ä¸äº†è§£ Mr.ğŸ†– AI DB
  ç‰ˆçš„éƒ¨ç½²åŸç†ï¼Œè¯·å…ˆæŸ¥é˜… [ä½¿ç”¨æœåŠ¡ç«¯æ•°æ®åº“éƒ¨ç½²](/zh/docs/self-hosting/server-database) ã€‚
  æ­¤å¤–ï¼Œé’ˆå¯¹å›½å†…çš„è…¾è®¯äº‘å‚¨å­˜æ¡¶ç”¨æˆ·ï¼Œå¯æŸ¥è¯¢[é…ç½®è…¾è®¯äº‘ COS
  å­˜å‚¨æœåŠ¡](/zh/docs/self-hosting/advanced/s3/tencent-cloud)ã€‚
</Callout>

<Callout type="warning">
  ç”±äºæ— æ³•ä½¿ç”¨ Docker ç¯å¢ƒå˜é‡æš´éœ² `NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY`ï¼Œä½¿ç”¨ Docker / Docker Compose
  éƒ¨ç½² Mr.ğŸ†– AI æ—¶ï¼Œä½ ä¸èƒ½ä½¿ç”¨ Clerk ä½œä¸ºç™»å½•é‰´æƒæœåŠ¡ã€‚

å¦‚æœä½ ç¡®å®éœ€è¦ Clerk ä½œä¸ºç™»å½•é‰´æƒæœåŠ¡ï¼Œä½ å¯ä»¥è€ƒè™‘ä½¿ç”¨ Vercel éƒ¨ç½²æˆ–è€…è‡ªè¡Œæ„å»ºé•œåƒã€‚

</Callout>

## åœ¨ Linux æœåŠ¡å™¨ä¸Šéƒ¨ç½²

ä»¥ä¸‹æ˜¯åœ¨ Linux æœåŠ¡å™¨ä¸Šéƒ¨ç½² Mr.ğŸ†– AI DB ç‰ˆçš„æµç¨‹ï¼š

<Steps>

### åˆ›å»º Postgres æ•°æ®åº“å®ä¾‹

è¯·æŒ‰ç…§ä½ è‡ªå·±çš„è¯‰æ±‚åˆ›å»ºä¸€ä¸ªå¸¦æœ‰ PGVector æ’ä»¶çš„ Postgres æ•°æ®åº“å®ä¾‹ï¼Œä¾‹å¦‚ï¼š

```sh
docker network create pg

docker run --name my-postgres --network pg -e POSTGRES_PASSWORD=mysecretpassword -p 5432:5432 -d pgvector/pgvector:pg16
```

ä¸Šè¿°æŒ‡ä»¤ä¼šåˆ›å»ºä¸€ä¸ªåä¸º `my-postgres`ï¼Œå¹¶ä¸”ç½‘ç»œä¸º `pg` çš„ PG å®ä¾‹ï¼Œå…¶ä¸­ `pgvector/pgvector:pg16` æ˜¯ä¸€ä¸ª Postgres 16 çš„é•œåƒï¼Œä¸”é»˜è®¤å®‰è£…äº† pgvector æ’ä»¶ã€‚

<Callout type="info">
  pgvector æ’ä»¶ä¸º Postgres æä¾›äº†å‘é‡æœç´¢çš„èƒ½åŠ›ï¼Œæ˜¯ Mr.ğŸ†– AI å®ç° RAG çš„é‡è¦æ„ä»¶ä¹‹ä¸€ã€‚
</Callout>

<Callout type="warning">
  ä»¥ä¸ŠæŒ‡ä»¤å¾—åˆ°çš„ pg
  å®ä¾‹å¹¶æ²¡æœ‰æŒ‡å®šæŒä¹…åŒ–å­˜å‚¨ä½ç½®ï¼Œå› æ­¤ä»…ç”¨äºæµ‹è¯•/æ¼”ç¤ºï¼Œç”Ÿäº§ç¯å¢ƒè¯·è‡ªè¡Œé…ç½®æŒä¹…åŒ–å­˜å‚¨ã€‚
</Callout>

### åˆ›å»ºåä¸º `lobe-chat.env` æ–‡ä»¶ç”¨äºå­˜æ”¾ç¯å¢ƒå˜é‡ï¼š

```shell
# ç½‘ç«™åŸŸå
APP_URL=https://your-prod-domain.com

# DB å¿…é¡»çš„ç¯å¢ƒå˜é‡
# ç”¨äºåŠ å¯†æ•æ„Ÿä¿¡æ¯çš„å¯†é’¥ï¼Œå¯ä»¥ä½¿ç”¨ openssl rand -base64 32 ç”Ÿæˆ
KEY_VAULTS_SECRET='jgwsK28dspyVQoIf8/M3IIHl1h6LYYceSYNXeLpy6uk='
# Postgres æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
# æ ¼å¼ï¼špostgres://username:password@host:port/dbnameï¼Œå¦‚æœä½ çš„ pg å®ä¾‹ä¸º Docker å®¹å™¨ï¼Œè¯·ä½¿ç”¨å®¹å™¨å
DATABASE_URL=postgres://postgres:mysecretpassword@my-postgres:5432/postgres

# NEXT_AUTH ç›¸å…³ï¼Œå¯ä»¥ä½¿ç”¨ auth0ã€Azure ADã€GitHubã€Authentikã€zitadel ç­‰ï¼Œå¦‚æœ‰å…¶ä»–æ¥å…¥è¯‰æ±‚æ¬¢è¿æ PR
NEXT_AUTH_SECRET=3904039cd41ea1bdf6c93db0db96e250
NEXT_AUTH_SSO_PROVIDERS=auth0
NEXTAUTH_URL=https://your-prod-domain.com/api/auth
AUTH_AUTH0_ID=xxxxxx
AUTH_AUTH0_SECRET=cSX_xxxxx
AUTH_AUTH0_ISSUER=https://lobe-chat-demo.us.auth0.com

# S3 ç›¸å…³
S3_ACCESS_KEY_ID=xxxxxxxxxx
S3_SECRET_ACCESS_KEY=xxxxxxxxxx
# ç”¨äº S3 API è®¿é—®çš„åŸŸå
S3_ENDPOINT=https://xxxxxxxxxx.r2.cloudflarestorage.com
S3_BUCKET=Mr.ğŸ†– AI
# ç”¨äºå¤–ç½‘è®¿é—® S3 çš„å…¬å…±åŸŸåï¼Œéœ€é…ç½® CORS
S3_PUBLIC_DOMAIN=https://s3-for-Mr.ğŸ†– AI.your-domain.com
# S3_REGION=ap-chengdu # å¦‚æœéœ€è¦æŒ‡å®šåœ°åŸŸ

# å…¶ä»–ç¯å¢ƒå˜é‡ï¼Œè§†éœ€æ±‚è€Œå®š
# OPENAI_API_KEY=sk-xxxx
# OPENAI_PROXY_URL=https://api.openai.com/v1
# OPENAI_MODEL_LIST=...
# ...
```

### å¯åŠ¨ lobe-chat-database docker é•œåƒ

```sh
docker run -it -d -p 3210:3210 --network pg --env-file lobe-chat.env --name lobe-chat-database lobehub/lobe-chat-database
```

ä½ å¯ä»¥ä½¿ç”¨ä¸‹è¿°æŒ‡ä»¤æ£€æŸ¥æ—¥å¿—ï¼š

```sh
docker logs -f lobe-chat-database
```

å¦‚æœä½ åœ¨å®¹å™¨ä¸­çœ‹åˆ°äº†ä»¥ä¸‹æ—¥å¿—ï¼Œåˆ™è¯´æ˜å·²ç»å¯åŠ¨æˆåŠŸï¼š

```log
[Database] Start to migration...
âœ… database migration pass.
-------------------------------------
  â–² Next.js 14.x.x
  - Local:        http://localhost:3210
  - Network:      http://0.0.0.0:3210

 âœ“ Starting...
 âœ“ Ready in 95ms
```

</Steps>

<Callout type="tip">
  åœ¨æˆ‘ä»¬å®˜æ–¹çš„ Docker é•œåƒä¸­ï¼Œä¼šåœ¨å¯åŠ¨é•œåƒå‰è‡ªåŠ¨æ‰§è¡Œæ•°æ®åº“ schema çš„ migration
  ï¼Œæˆ‘ä»¬çš„å®˜æ–¹é•œåƒæ‰¿è¯ºã€Œç©ºæ•°æ®åº“ ->
  å®Œæ•´è¡¨ã€è¿™ä¸€æ®µè‡ªåŠ¨å»ºè¡¨çš„ç¨³å®šæ€§ã€‚å› æ­¤æˆ‘ä»¬å»ºè®®ä½ çš„æ•°æ®åº“å®ä¾‹ä½¿ç”¨ä¸€ä¸ªç©ºè¡¨å®ä¾‹ï¼Œè¿›è€Œçœå»æ‰‹åŠ¨ç»´æŠ¤è¡¨ç»“æ„æˆ–è€…
  migration çš„éº»çƒ¦ã€‚
</Callout>

## åœ¨æœ¬åœ°ï¼ˆMac / Windowsï¼‰ ä¸Šä½¿ç”¨

Mr.ğŸ†– AI çš„ DB ç‰ˆä¹Ÿæ”¯æŒç›´æ¥åœ¨æœ¬åœ°çš„ Mac/Windows æœ¬åœ°ä½¿ç”¨ã€‚

åœ¨æ­¤æˆ‘ä»¬å·²å‡è®¾ä½ çš„æœ¬åœ°æœ‰ä¸€ä¸ª 5432 ç«¯å£å¯ç”¨ï¼Œè´¦å·ä¸º `postgres` ï¼Œå¯†ç æ˜¯ `mysecretpassword` çš„ pg å®ä¾‹ï¼Œå®ƒåœ¨ `localhost:5432` å¯ç”¨ã€‚

é‚£ä¹ˆä½ éœ€è¦æ‰§è¡Œçš„è„šæœ¬æŒ‡ä»¤ä¸ºï¼š

```shell
$ docker run -it -d --name lobe-chat-database -p 3210:3210 \
  -e DATABASE_URL=postgres://postgres:mysecretpassword@host.docker.internal:5432/postgres \
  -e KEY_VAULTS_SECRET=jgwsK28dspyVQoIf8/M3IIHl1h6LYYceSYNXeLpy6uk= \
  -e NEXT_AUTH_SECRET=3904039cd41ea1bdf6c93db0db96e250 \
  -e NEXT_AUTH_SSO_PROVIDERS=auth0 \
  -e AUTH_AUTH0_ID=xxxxxx \
  -e AUTH_AUTH0_SECRET=cSX_xxxxx \
  -e AUTH_AUTH0_ISSUER=https://lobe-chat-demo.us.auth0.com \
  -e APP_URL=http://localhost:3210 \
  -e NEXTAUTH_URL=http://localhost:3210/api/auth \
  -e S3_ACCESS_KEY_ID=xxxxxxxxxx \
  -e S3_SECRET_ACCESS_KEY=xxxxxxxxxx \
  -e S3_ENDPOINT=https://xxxxxxxxxx.r2.cloudflarestorage.com \
  -e S3_BUCKET=Mr.ğŸ†– AI \
  -e S3_PUBLIC_DOMAIN=https://s3-for-Mr.ğŸ†– AI.your-domain.com \
  lobehub/lobe-chat-database
```

<Callout type="tip">
  `Docker` åœ¨ `Windows` å’Œ `macOS` ä¸Šèµ°çš„æ˜¯è™šæ‹Ÿæœºæ–¹æ¡ˆï¼Œå¦‚æœä½¿ç”¨ `localhost` / `127.0.0.1`
  ï¼Œå°†ä¼šèµ°åˆ°è‡ªèº«å®¹å™¨çš„ `localhost`ï¼Œæ­¤æ—¶è¯·å°è¯•ç”¨ `host.docker.internal` æ›¿ä»£ `localhost`
</Callout>

[docker-pulls-link]: https://hub.docker.com/r/lobehub/lobe-chat-database
[docker-pulls-shield]: https://img.shields.io/docker/pulls/lobehub/lobe-chat-database?color=45cc11&labelColor=black&style=flat-square
[docker-release-link]: https://hub.docker.com/r/lobehub/lobe-chat-database
[docker-release-shield]: https://img.shields.io/docker/v/lobehub/lobe-chat-database?color=369eff&label=docker&labelColor=black&logo=docker&logoColor=white&style=flat-square
[docker-size-link]: https://hub.docker.com/r/lobehub/lobe-chat-database
[docker-size-shield]: https://img.shields.io/docker/image-size/lobehub/lobe-chat-database?color=369eff&labelColor=black&style=flat-square
